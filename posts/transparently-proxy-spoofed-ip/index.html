<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to Transparently Proxy IP Packets With Spoofed Destinations | Dominik Rys</title>
<meta name=keywords content="Security,Networking,iptables,Linux"><meta name=description content="I&rsquo;ve recently worked on a security project which required me to transparently proxy IP packets that have had their destination IPs spoofed. By this, I mean that the destination IP in an IP packet is not the IP of the destination which a DNS request would correctly resolve. For example, this could be due to a DNS query being spoofed and sending an IP address of another destination in reply. The diagram above shows what we want to achieve."><meta name=author content><link rel=canonical href=https://dominikrys.com/posts/transparently-proxy-spoofed-ip/><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://dominikrys.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dominikrys.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dominikrys.com/favicon-32x32.png><link rel=apple-touch-icon href=https://dominikrys.com/apple-touch-icon.png><link rel=mask-icon href=https://dominikrys.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://dominikrys.com/posts/transparently-proxy-spoofed-ip/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-FZL8HVTHR8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FZL8HVTHR8")}</script><meta property="og:url" content="https://dominikrys.com/posts/transparently-proxy-spoofed-ip/"><meta property="og:site_name" content="Dominik Rys"><meta property="og:title" content="How to Transparently Proxy IP Packets With Spoofed Destinations"><meta property="og:description" content="I’ve recently worked on a security project which required me to transparently proxy IP packets that have had their destination IPs spoofed. By this, I mean that the destination IP in an IP packet is not the IP of the destination which a DNS request would correctly resolve. For example, this could be due to a DNS query being spoofed and sending an IP address of another destination in reply. The diagram above shows what we want to achieve."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-04-17T10:44:53+01:00"><meta property="article:modified_time" content="2021-04-17T10:44:53+01:00"><meta property="article:tag" content="Security"><meta property="article:tag" content="Networking"><meta property="article:tag" content="Iptables"><meta property="article:tag" content="Linux"><meta property="og:image" content="https://dominikrys.com/img/diagram.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dominikrys.com/img/diagram.png"><meta name=twitter:title content="How to Transparently Proxy IP Packets With Spoofed Destinations"><meta name=twitter:description content="I&rsquo;ve recently worked on a security project which required me to transparently proxy IP packets that have had their destination IPs spoofed. By this, I mean that the destination IP in an IP packet is not the IP of the destination which a DNS request would correctly resolve. For example, this could be due to a DNS query being spoofed and sending an IP address of another destination in reply. The diagram above shows what we want to achieve."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dominikrys.com/posts/"},{"@type":"ListItem","position":2,"name":"How to Transparently Proxy IP Packets With Spoofed Destinations","item":"https://dominikrys.com/posts/transparently-proxy-spoofed-ip/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to Transparently Proxy IP Packets With Spoofed Destinations","name":"How to Transparently Proxy IP Packets With Spoofed Destinations","description":"I\u0026rsquo;ve recently worked on a security project which required me to transparently proxy IP packets that have had their destination IPs spoofed. By this, I mean that the destination IP in an IP packet is not the IP of the destination which a DNS request would correctly resolve. For example, this could be due to a DNS query being spoofed and sending an IP address of another destination in reply. The diagram above shows what we want to achieve.\n","keywords":["Security","Networking","iptables","Linux"],"articleBody":"I’ve recently worked on a security project which required me to transparently proxy IP packets that have had their destination IPs spoofed. By this, I mean that the destination IP in an IP packet is not the IP of the destination which a DNS request would correctly resolve. For example, this could be due to a DNS query being spoofed and sending an IP address of another destination in reply. The diagram above shows what we want to achieve.\nIn this post, I will explain how it’s possible to proxy such HTTP traffic by redirecting it to the correct destination.\nWhy Can’t Spoofed DNS Packets be Proxied Using an Ordinary Transparent Proxy? When an IP packet with a spoofed destination IP reaches its destination server, the server will handle it like any other IP packet that has been destined for it. Ordinary transparent proxying tools such as Squid are usually configured as internet gateways, so they are not the final destination of the IP packets that pass through them. Since the final destination IP of each packet is known in such setups, these tools can easily send packets to their destination. If the destination IP is the proxy, as it would be in the case of spoofed destination IPs, the transparent proxy would need to additionally resolve the original destination IP. Most such tools don’t have support for this.\nHow to Reclaim the Original Destination? To reclaim the original destination, the Host header can be used which is required by HTTP/1.1. The Host header contains the domain name that the client wants to access. In the case of spoofed destination IPs, this header will be intact and pointing to the un-spoofed destination.\nTo reclaim the original destination, proxy software is needed that can do a DNS lookup on the Host header and send traffic to the destination resulting from the lookup. Sadly, in this case, the most popular transparent proxy software won’t work. I tried extensively to make this work with Squid, but there are some reasons why it’s not possible (more here and here).\nIt’s also worth mentioning that since this proxy will change the destination IP of the packet, it stops being “transparent”, and is now an “intercepting” proxy. I thought that this term is reserved for slightly more involved proxies such as Burp, but it also applies in this case.\nTo resolve packets according to their Host header, I used Privoxy in intercepting mode, which I will explain how to configure.\nHow to Configure Privoxy to Resolve Spoofed IP packets? Luckily the configuration for Privoxy is very simple. First, install it using your operating system’s package manager. Next, modify its configuration file under etc/privoxy/config with the following details, where INTERFACE_IP is the IP of the interface that you want Privoxy to listen at:\nlisten-address INTERFACE_IP:3128 accept-intercepted-requests 1 debug 1 Note that debug 1 is not strictly needed, but it will allow us to see if requests are coming through to the server. accept-intercepted-requests 1 is the important part, which enabled the “intercepting” mode of Privoxy.\nNext, restart privoxy:\nsudo systemctl restart privoxy Finally, add an iptables rule to redirect traffic from the HTTP port to the port that Privoxy is listening at:\nsudo iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8118 You can modify the above rule or add additional ones if you have other interfaces apart from eth0 that you’d like to forward traffic from.\nNow you can send some spoofed requests to the server and check if you can see them in the logs:\n$ sudo tail -f /var/log/privoxy/logfile 2021-04-15 15:06:24.434 7f39feffd700 Request: scratchpads.org/ 2021-04-15 15:06:24.789 7f39feffd700 Request: scratchpads.org/css/main.css 2021-04-15 15:06:24.795 7f39dffff700 Request: scratchpads.org/css/index.css 2021-04-15 15:06:24.931 7f39ff7fe700 Request: work.a-poster.info:25000/ 2021-04-15 15:06:26.503 7f39dffff700 Request: scratchpads.org/assets/why/accordion.js 2021-04-15 15:06:26.554 7f39feffd700 Request: scratchpads.org/assets/index.js HTTPS Support? The method described in this post won’t work for HTTPS requests, since the HTTP header will be encrypted and the Host header won’t be able to be read. As far as I know there are no tools available that would be able to do this. In theory, it’s possible to make this work with HTTPS in a transparent manner, but with substantial engineering effort.\nI’m envisioning a solution where the spoofing DNS server redirects each request to a different machine, where each machine knows about the original destination of the packets. The machines can then redirect packets to their correct destinations. The contents will still be encrypted, so it’s questionable whether something like this would be worth doing at all.\n","wordCount":"753","inLanguage":"en","image":"https://dominikrys.com/img/diagram.png","datePublished":"2021-04-17T10:44:53+01:00","dateModified":"2021-04-17T10:44:53+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dominikrys.com/posts/transparently-proxy-spoofed-ip/"},"publisher":{"@type":"Organization","name":"Dominik Rys","logo":{"@type":"ImageObject","url":"https://dominikrys.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dominikrys.com/ accesskey=h title="Dominik Rys (Alt + H)">Dominik Rys</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://dominikrys.com/tags title=🔖 Tags><span>🔖 Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">How to Transparently Proxy IP Packets With Spoofed Destinations</h1><div class=post-meta><span title='2021-04-17 10:44:53 +0100 +0100'>April 17, 2021</span>&nbsp;·&nbsp;4 min</div></header><figure class=entry-cover><img loading=eager srcset="https://dominikrys.com/posts/transparently-proxy-spoofed-ip/img/diagram_hu14391706686089258690.png 360w ,https://dominikrys.com/posts/transparently-proxy-spoofed-ip/img/diagram_hu2539997105456351668.png 480w ,https://dominikrys.com/posts/transparently-proxy-spoofed-ip/img/diagram_hu15725765863482014477.png 720w ,https://dominikrys.com/posts/transparently-proxy-spoofed-ip/img/diagram_hu12832759341507919201.png 1080w ,https://dominikrys.com/posts/transparently-proxy-spoofed-ip/img/diagram_hu17032371875360866873.png 1500w ,https://dominikrys.com/posts/transparently-proxy-spoofed-ip/img/diagram.png 3835w" sizes="(min-width: 768px) 720px, 100vw" src=https://dominikrys.com/posts/transparently-proxy-spoofed-ip/img/diagram.png alt="Proxy Diagram" width=3835 height=1435></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#why-cant-spoofed-dns-packets-be-proxied-using-an-ordinary-transparent-proxy aria-label="Why Can&rsquo;t Spoofed DNS Packets be Proxied Using an Ordinary Transparent Proxy?">Why Can&rsquo;t Spoofed DNS Packets be Proxied Using an Ordinary Transparent Proxy?</a></li><li><a href=#how-to-reclaim-the-original-destination aria-label="How to Reclaim the Original Destination?">How to Reclaim the Original Destination?</a></li><li><a href=#how-to-configure-privoxy-to-resolve-spoofed-ip-packets aria-label="How to Configure Privoxy to Resolve Spoofed IP packets?">How to Configure Privoxy to Resolve Spoofed IP packets?</a></li><li><a href=#https-support aria-label="HTTPS Support?">HTTPS Support?</a></li></ul></div></details></div><div class=post-content><p>I&rsquo;ve recently worked on a security project which required me to transparently proxy IP packets that have had their destination IPs spoofed. By this, I mean that the destination IP in an IP packet is <strong>not</strong> the IP of the destination which a DNS request would correctly resolve. For example, this could be due to a DNS query being spoofed and sending an IP address of another destination in reply. The diagram above shows what we want to achieve.</p><p>In this post, I will explain how it&rsquo;s possible to proxy such HTTP traffic by redirecting it to the correct destination.</p><h2 id=why-cant-spoofed-dns-packets-be-proxied-using-an-ordinary-transparent-proxy>Why Can&rsquo;t Spoofed DNS Packets be Proxied Using an Ordinary Transparent Proxy?<a hidden class=anchor aria-hidden=true href=#why-cant-spoofed-dns-packets-be-proxied-using-an-ordinary-transparent-proxy>#</a></h2><p>When an IP packet with a spoofed destination IP reaches its destination server, the server will handle it like any other IP packet that has been destined for it. Ordinary transparent proxying tools such as <a href=http://www.squid-cache.org/>Squid</a> are usually configured as internet gateways, so they are not the final destination of the IP packets that pass through them. Since the final destination IP of each packet is known in such setups, these tools can easily send packets to their destination. If the destination IP <strong>is</strong> the proxy, as it would be in the case of spoofed destination IPs, the transparent proxy would need to additionally resolve the original destination IP. Most such tools don&rsquo;t have support for this.</p><h2 id=how-to-reclaim-the-original-destination>How to Reclaim the Original Destination?<a hidden class=anchor aria-hidden=true href=#how-to-reclaim-the-original-destination>#</a></h2><p>To reclaim the original destination, the <code>Host</code> header can be used which is <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Host>required by HTTP/1.1</a>. The <code>Host</code> header contains the domain name that the client wants to access. In the case of spoofed destination IPs, this header will be intact and pointing to the un-spoofed destination.</p><p>To reclaim the original destination, proxy software is needed that can do a DNS lookup on the <code>Host</code> header and send traffic to the destination resulting from the lookup. Sadly, in this case, the most popular transparent proxy software won&rsquo;t work. I tried extensively to make this work with Squid, but there are some reasons why it&rsquo;s not possible (more <a href=http://squid-web-proxy-cache.1019090.n4.nabble.com/TProxy-and-client-dst-passthru-td4670189.html>here</a> and <a href=http://squid-web-proxy-cache.1019090.n4.nabble.com/Force-squid-use-dns-query-result-as-the-destination-server-in-squid-tproxy-td4664036.html>here</a>).</p><p>It&rsquo;s also worth mentioning that since this proxy will change the destination IP of the packet, it stops being &ldquo;transparent&rdquo;, and is now an &ldquo;intercepting&rdquo; proxy. I thought that this term is reserved for slightly more involved proxies such as <a href=https://portswigger.net/burp/documentation/desktop/tools/proxy/getting-started>Burp</a>, but it also applies in this case.</p><p>To resolve packets according to their <code>Host</code> header, I used <a href=https://www.privoxy.org/><strong>Privoxy</strong></a> in <a href=https://www.privoxy.org/faq/configuration.html#INTERCEPTING>intercepting mode</a>, which I will explain how to configure.</p><h2 id=how-to-configure-privoxy-to-resolve-spoofed-ip-packets>How to Configure Privoxy to Resolve Spoofed IP packets?<a hidden class=anchor aria-hidden=true href=#how-to-configure-privoxy-to-resolve-spoofed-ip-packets>#</a></h2><p>Luckily the configuration for Privoxy is very simple. First, install it using your operating system&rsquo;s package manager. Next, modify its configuration file under <code>etc/privoxy/config</code> with the following details, where <code>INTERFACE_IP</code> is the IP of the interface that you want Privoxy to listen at:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>listen-address INTERFACE_IP:3128
</span></span><span style=display:flex><span>accept-intercepted-requests 1
</span></span><span style=display:flex><span>debug 1
</span></span></code></pre></div><p>Note that <code>debug 1</code> is not strictly needed, but it will allow us to see if requests are coming through to the server. <code>accept-intercepted-requests 1</code> is the important part, which enabled the &ldquo;intercepting&rdquo; mode of Privoxy.</p><p>Next, restart privoxy:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart privoxy
</span></span></code></pre></div><p>Finally, add an <code>iptables</code> rule to redirect traffic from the HTTP port to the port that Privoxy is listening at:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo iptables -t nat -A PREROUTING -i eth0 -p tcp --dport <span style=color:#ae81ff>80</span> -j REDIRECT --to-port <span style=color:#ae81ff>8118</span>
</span></span></code></pre></div><p>You can modify the above rule or add additional ones if you have other interfaces apart from <code>eth0</code> that you&rsquo;d like to forward traffic from.</p><p>Now you can send some spoofed requests to the server and check if you can see them in the logs:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo tail -f /var/log/privoxy/logfile
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>2021-04-15 15:06:24.434 7f39feffd700 Request: scratchpads.org/
</span></span><span style=display:flex><span>2021-04-15 15:06:24.789 7f39feffd700 Request: scratchpads.org/css/main.css
</span></span><span style=display:flex><span>2021-04-15 15:06:24.795 7f39dffff700 Request: scratchpads.org/css/index.css
</span></span><span style=display:flex><span>2021-04-15 15:06:24.931 7f39ff7fe700 Request: work.a-poster.info:25000/
</span></span><span style=display:flex><span>2021-04-15 15:06:26.503 7f39dffff700 Request: scratchpads.org/assets/why/accordion.js
</span></span><span style=display:flex><span>2021-04-15 15:06:26.554 7f39feffd700 Request: scratchpads.org/assets/index.js
</span></span></code></pre></div><h2 id=https-support>HTTPS Support?<a hidden class=anchor aria-hidden=true href=#https-support>#</a></h2><p>The method described in this post won&rsquo;t work for HTTPS requests, since the HTTP header will be encrypted and the <code>Host</code> header won&rsquo;t be able to be read. As far as I know there are no tools available that would be able to do this. In theory, it&rsquo;s possible to make this work with HTTPS in a transparent manner, but with substantial engineering effort.</p><p>I&rsquo;m envisioning a solution where the spoofing DNS server redirects each request to a different machine, where each machine knows about the original destination of the packets. The machines can then redirect packets to their correct destinations. The contents will still be encrypted, so it&rsquo;s questionable whether something like this would be worth doing at all.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dominikrys.com/tags/security/>Security</a></li><li><a href=https://dominikrys.com/tags/networking/>Networking</a></li><li><a href=https://dominikrys.com/tags/iptables/>Iptables</a></li><li><a href=https://dominikrys.com/tags/linux/>Linux</a></li></ul><nav class=paginav><a class=prev href=https://dominikrys.com/posts/disable-udp-checksum-validation/><span class=title>« Prev</span><br><span>How to Disable UDP Checksum Validation in Linux</span>
</a><a class=next href=https://dominikrys.com/posts/squid-transparent-proxy/><span class=title>Next »</span><br><span>Configuring Squid as a Transparent Proxy</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share How to Transparently Proxy IP Packets With Spoofed Destinations on x" href="https://x.com/intent/tweet/?text=How%20to%20Transparently%20Proxy%20IP%20Packets%20With%20Spoofed%20Destinations&amp;url=https%3a%2f%2fdominikrys.com%2fposts%2ftransparently-proxy-spoofed-ip%2f&amp;hashtags=Security%2cNetworking%2ciptables%2cLinux"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to Transparently Proxy IP Packets With Spoofed Destinations on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fdominikrys.com%2fposts%2ftransparently-proxy-spoofed-ip%2f&amp;title=How%20to%20Transparently%20Proxy%20IP%20Packets%20With%20Spoofed%20Destinations&amp;summary=How%20to%20Transparently%20Proxy%20IP%20Packets%20With%20Spoofed%20Destinations&amp;source=https%3a%2f%2fdominikrys.com%2fposts%2ftransparently-proxy-spoofed-ip%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to Transparently Proxy IP Packets With Spoofed Destinations on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdominikrys.com%2fposts%2ftransparently-proxy-spoofed-ip%2f&title=How%20to%20Transparently%20Proxy%20IP%20Packets%20With%20Spoofed%20Destinations"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to Transparently Proxy IP Packets With Spoofed Destinations on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fdominikrys.com%2fposts%2ftransparently-proxy-spoofed-ip%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to Transparently Proxy IP Packets With Spoofed Destinations on whatsapp" href="https://api.whatsapp.com/send?text=How%20to%20Transparently%20Proxy%20IP%20Packets%20With%20Spoofed%20Destinations%20-%20https%3a%2f%2fdominikrys.com%2fposts%2ftransparently-proxy-spoofed-ip%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to Transparently Proxy IP Packets With Spoofed Destinations on telegram" href="https://telegram.me/share/url?text=How%20to%20Transparently%20Proxy%20IP%20Packets%20With%20Spoofed%20Destinations&amp;url=https%3a%2f%2fdominikrys.com%2fposts%2ftransparently-proxy-spoofed-ip%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to Transparently Proxy IP Packets With Spoofed Destinations on ycombinator" href="https://news.ycombinator.com/submitlink?t=How%20to%20Transparently%20Proxy%20IP%20Packets%20With%20Spoofed%20Destinations&u=https%3a%2f%2fdominikrys.com%2fposts%2ftransparently-proxy-spoofed-ip%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//dominikrys.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://dominikrys.com/>Dominik Rys</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>