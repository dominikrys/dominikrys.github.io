<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Dominik Rys ">
<meta name="description" content="Introduction A couple of months ago I wrote a CHIP-8 emulator in C&#43;&#43;17, as I wanted to learn about emulation and expand my C&#43;&#43; knowledge outside of work. In this post I&amp;rsquo;ll explain how I went about compiling the emulator which was designed to run natively, to also run on the web using the magic of WebAssembly. You can try out the result here.
My main motivation for getting the emulator working on the web was that in its current state, it took some effort to get it up and running." />
<meta name="keywords" content="blog, software, engineering, software engineering, devops, software development, computer science, software engineering, webassembly, c&#43;&#43;, emscripten, sdl" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<link rel="canonical" href="https://dominikrys.com/posts/2020/08/compiling-a-c-chip-8-emulator-to-webassembly/" />


    <title>
        
            Compiling a C&#43;&#43; CHIP-8 Emulator to WebAssembly :: Dominik Rys 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://dominikrys.com/main.031a8efc33f94f55a4071bf4e91596478a5809fc8c148fab113801189cfd2152.css">




    <link rel="apple-touch-icon" sizes="180x180" href="https://dominikrys.com/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://dominikrys.com/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://dominikrys.com/favicon-16x16.png">
    <link rel="manifest" href="https://dominikrys.com/site.webmanifest">
    <link rel="mask-icon" href="https://dominikrys.com/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="https://dominikrys.com/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">



<meta itemprop="name" content="Compiling a C&#43;&#43; CHIP-8 Emulator to WebAssembly">
<meta itemprop="description" content="Introduction A couple of months ago I wrote a CHIP-8 emulator in C&#43;&#43;17, as I wanted to learn about emulation and expand my C&#43;&#43; knowledge outside of work. In this post I&rsquo;ll explain how I went about compiling the emulator which was designed to run natively, to also run on the web using the magic of WebAssembly. You can try out the result here.
My main motivation for getting the emulator working on the web was that in its current state, it took some effort to get it up and running."><meta itemprop="datePublished" content="2020-08-15T16:55:48+01:00" />
<meta itemprop="dateModified" content="2020-08-15T16:55:48+01:00" />
<meta itemprop="wordCount" content="3380"><meta itemprop="image" content="https://dominikrys.com"/>
<meta itemprop="keywords" content="software engineering,webassembly,c&#43;&#43;,emscripten,sdl," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://dominikrys.com"/>

<meta name="twitter:title" content="Compiling a C&#43;&#43; CHIP-8 Emulator to WebAssembly"/>
<meta name="twitter:description" content="Introduction A couple of months ago I wrote a CHIP-8 emulator in C&#43;&#43;17, as I wanted to learn about emulation and expand my C&#43;&#43; knowledge outside of work. In this post I&rsquo;ll explain how I went about compiling the emulator which was designed to run natively, to also run on the web using the magic of WebAssembly. You can try out the result here.
My main motivation for getting the emulator working on the web was that in its current state, it took some effort to get it up and running."/>




    <meta property="og:title" content="Compiling a C&#43;&#43; CHIP-8 Emulator to WebAssembly" />
<meta property="og:description" content="Introduction A couple of months ago I wrote a CHIP-8 emulator in C&#43;&#43;17, as I wanted to learn about emulation and expand my C&#43;&#43; knowledge outside of work. In this post I&rsquo;ll explain how I went about compiling the emulator which was designed to run natively, to also run on the web using the magic of WebAssembly. You can try out the result here.
My main motivation for getting the emulator working on the web was that in its current state, it took some effort to get it up and running." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dominikrys.com/posts/2020/08/compiling-a-c-chip-8-emulator-to-webassembly/" /><meta property="og:image" content="https://dominikrys.com"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-15T16:55:48+01:00" />
<meta property="article:modified_time" content="2020-08-15T16:55:48+01:00" />







    <meta property="article:published_time" content="2020-08-15 16:55:48 &#43;0100 BST" />









    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FZL8HVTHR8"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-FZL8HVTHR8', { 'anonymize_ip': false });
}
</script>


    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://dominikrys.com/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#67a2c9;
                   animation-duration:2s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://dominikrys.com/posts/">Blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>

    <link rel="apple-touch-icon" sizes="180x180" href="https://dominikrys.com/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://dominikrys.com/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://dominikrys.com/favicon-16x16.png">
    <link rel="manifest" href="https://dominikrys.com/site.webmanifest">
    <link rel="mask-icon" href="https://dominikrys.com/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        16 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://dominikrys.com/posts/2020/08/compiling-a-c-chip-8-emulator-to-webassembly/">Compiling a C++ CHIP-8 Emulator to WebAssembly</a>
      </h1>

      

      
        <hr />
        <aside id="toc">
          <div class="toc-title">Table of Contents</div>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#setting-up-emscripten">Setting up Emscripten</a></li>
    <li><a href="#cmake-and-emscripten">CMake and Emscripten</a>
      <ul>
        <li><a href="#potential-cmake-problem">Potential CMake problem</a></li>
        <li><a href="#adding-emscripten-sections-to-cmakelists">Adding Emscripten sections to CMakeLists</a></li>
      </ul>
    </li>
    <li><a href="#initial-compile">Initial compile</a></li>
    <li><a href="#debugging-emscripten">Debugging Emscripten</a></li>
    <li><a href="#file-system-access-in-emscripten">File system access in Emscripten</a></li>
    <li><a href="#emscripten-loops">Emscripten loops</a>
      <ul>
        <li><a href="#rewriting-for-a-global-function-in-the-main-loop">Rewriting for a global function in the main loop</a></li>
        <li><a href="#emterpreter">Emterpreter</a></li>
        <li><a href="#frame-rate-issues">Frame rate issues</a></li>
      </ul>
    </li>
    <li><a href="#exporting-c-functions-to-call-from-javascript">Exporting C++ functions to call from JavaScript</a></li>
    <li><a href="#audio">Audio</a></li>
    <li><a href="#finishing-touches">Finishing touches</a></li>
    <li><a href="#the-end">The end!</a></li>
  </ul>
</nav>
        </aside>
        <hr />

      

      <div class="post-content">
        
    <img src="img/full-emulator.png"  alt="CHIP-8 Emulator"  class="center"  style="border-radius: 0.5em;"  />


<h2 id="introduction">Introduction</h2>
<p>A couple of months ago I wrote a <a href="https://github.com/dominikrys/chip8">CHIP-8 emulator</a> in C++17, as I wanted to learn about emulation and expand my C++ knowledge outside of work. In this post I&rsquo;ll explain how I went about compiling the emulator which was designed to run natively, to also run on the web using the magic of WebAssembly. You can try out the result <strong><a href="https://dominikrys.com/chip8">here</a></strong>.</p>
<p>My main motivation for getting the emulator working on the web was that in its current state, it took some effort to get it up and running. I could send someone the pre-compiled binary or give building instructions, but those aren&rsquo;t guaranteed to work on every platform. Ideally, I wanted a solution that can be hosted on the web, and I recently heard about this cool new &ldquo;WebAssembly&rdquo; thing that seemed like the perfect solution.</p>
<p><a href="https://webassembly.org/">WebAssembly</a> is a binary instruction format that runs on modern web browsers and allows apps to run at &ldquo;near-native speed&rdquo;. In reality, there is a <a href="https://www.usenix.org/conference/atc19/presentation/jangda">performance hit of about 50% relative to their native counterparts</a> so it won&rsquo;t be great at running AI or HFT algorithms in your web browser, but it will be good enough to play Space Invaders.</p>
<p>To get our Wasm output, <a href="https://emscripten.org/">Emscripten</a> can be used. It&rsquo;s a toolchain that can compile C, C++, and any language which uses LLVM into WebAssembly.</p>
<p>Armed with these tools, the idea was simple: compile my emulator using Emscripten, sort out any errors, and deploy it on a website. An afternoon&rsquo;s work, right? &hellip;not quite. Turns out that there were a couple of pitfalls along the way, so I thought I&rsquo;d document my journey of compiling a loop-based C++ program running into WebAssembly for future me&rsquo;s reference once WebAssembly takes over the world, or for anyone else that may be attempting a similar task themselves</p>
<h2 id="setting-up-emscripten">Setting up Emscripten</h2>
<p>I&rsquo;ve set up Emscripten and did all the development described in this post on a Windows 10 machine (Unix fanboys, please stay with me - mentions of Windows end here). The setup will look very similar on other platforms and a lot of the code/configuration I mention <em>should</em> work on Mac and Linux, and if not then with minimal adjustments.</p>
<p><a href="https://developer.mozilla.org/en-US/docs/WebAssembly/C_to_wasm">Mozilla&rsquo;s article on compiling C/C++ modules to WebAssembly</a> was a great crash-course for setting up and starting to work with Emscripten. I recommend it as a starting point for anything WebAssembly related.</p>
<p>It&rsquo;s worth pointing out there aren&rsquo;t many IDE plugins or integrations for Emscripten as of writing this post. I tried to hack as much integration as I could into CLion, but what I managed to get to work caused issues for me later on. Emscripten relies on its own compilers and linkers a lot, so I would recommend sticking solely to the terminal to save yourself some headaches.</p>
<h2 id="cmake-and-emscripten">CMake and Emscripten</h2>
<p>Since my emulator is a not a single file as in the Mozilla examples mentioned in the section above, the most appropriate way to compile the emulator was to use CMake. I took the compiler flags mentioned in the Mozilla examples and added them to my <code>CMakeLists.txt</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmake" data-lang="cmake">set(<span style="color:#e6db74">CMAKE_CXX_FLAGS</span> <span style="color:#e6db74">&#34;${CMAKE_CXX_FLAGS} -s WASM=1 --shell-file ${CMAKE_CURRENT_LIST_DIR}/web/shell_minimal.html&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Next I created a sub-directory in my root project directory for my CMake output (called <code>cmake-build-emscripten</code>) and called the following from it:</p>
<ul>
<li>
<p>To generate the project build system:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">emcmake cmake -G <span style="color:#e6db74">&#34;CodeBlocks - MinGW Makefiles&#34;</span> ..
</code></pre></div></li>
<li>
<p>To compile the code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mingw32-make
</code></pre></div></li>
</ul>
<h3 id="potential-cmake-problem">Potential CMake problem</h3>
<p>If you&rsquo;re using C++17 features, you may get <code>No such file or directory</code> errors referencing certain headers. This can be caused by accidentally compiling the code outside of Emscripten either by yourself or by your IDE. The sure-fire way to fix these is to clear the CMake project build system directory and re-create it.</p>
<h3 id="adding-emscripten-sections-to-cmakelists">Adding Emscripten sections to CMakeLists</h3>
<p>I wanted to maintain the ability to compile my code natively as well as being able to compile it using Emscripten. The CMake <code>EMSCRIPTEN</code> variable solves this problem, as it&rsquo;s set to true when compiling with Emscripten. Note that when compiling with Emscripten, the CMake <code>UNIX</code> variable will also be <code>true</code>, so make sure your branching logic is correct.</p>
<p>For the full <code>CMakeLists.txt</code> that I ended up using, look <a href="https://github.com/dominikrys/chip8/blob/master/CMakeLists.txt">here</a>.</p>
<h2 id="initial-compile">Initial compile</h2>
<p>I was almost ready to compile the code. Since the emulator is using <a href="https://www.libsdl.org/">SDL2</a> for audio and graphics, I also needed to specify the <code>-s USE_SDL=2</code> compiler flag. When this is specified, Emscripten will automatically download the <a href="https://github.com/emscripten-ports/SDL2">SDL2 Emscripten port</a>.</p>
<p>I hardcoded a ROM to the path, and compiled the source otherwise unaltered:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">Emscripten Release
-- Configuring done
-- Generating done
-- Build files have been written to: C:/dev/git/chip8/cmake-build-emscripten
Scanning dependencies of target chip8
[ 14%] Building CXX object CMakeFiles/chip8.dir/src/Chip8.cpp.o
[ 28%] Building CXX object CMakeFiles/chip8.dir/src/Renderer.cpp.o
[ 42%] Building CXX object CMakeFiles/chip8.dir/src/KeyboardHandler.cpp.o
[ 57%] Building CXX object CMakeFiles/chip8.dir/src/Configurator.cpp.o
[ 71%] Building CXX object CMakeFiles/chip8.dir/src/Audio.cpp.o
[ 85%] Building CXX object CMakeFiles/chip8.dir/src/Main.cpp.o
[100%] Linking CXX executable chip8.js
[100%] Built target chip8
</code></pre></div><p>It&hellip; worked? I hosted the generated page locally with Python</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 -m http.server
</code></pre></div><p>And had a look at it in Chrome. I found that the screen was blank, but there was an exception in the JavaScript console:</p>

    <img src="img/exception-after-fix.png"  alt="Exception after fix"  class="center"  style="border-radius: 0.5em;"  />


<p>Time to attempt some debugging!</p>
<h2 id="debugging-emscripten">Debugging Emscripten</h2>
<p>Investigating the JavaScript exception isn&rsquo;t particularly useful, as at that point the code has been generated by Emscripten and is very different to the source code. There is a section on debugging in the <a href="https://emscripten.org/docs/porting/Debugging.html">Emscripten docs</a>, but in essence the debugging tools aren&rsquo;t currently particularly robust and will require modifying the program&rsquo;s original source code.</p>
<p>The most helpful ways to debug Emscripten code that I found are:</p>
<ul>
<li>
<p>Setting the <code>ASSERTIONS=2</code> compiler flag. This catches some potential issues, but isn&rsquo;t particularly useful by itself. I also found this flag to crop up with red herrings sometimes which got me debugging issues that were either fine to ignore, or went away by themselves as I developed more of the code.</p>
</li>
<li>
<p><a href="https://emscripten.org/docs/porting/Debugging.html#handling-c-exceptions-from-javascript">Handling C++ exceptions from JavaScript</a>. This requires some extra compiler and linker arguments and some extra code, but will give you readable exceptions in the JavaScript console. Very useful if you know which function is throwing exceptions.</p>
</li>
<li>
<p><a href="https://emscripten.org/docs/porting/Debugging.html#manual-print-debugging">Manual print statements</a>. Not particularly sophisticated, but works well enough and helped me debug this first exception. Note that you should flush using <code>std::endl</code> or <code>&quot;\n&quot;</code> when using <code>std::cout</code> statements or else your messages won&rsquo;t get printed while your program is running, and only when it terminates.</p>
</li>
</ul>
<h2 id="file-system-access-in-emscripten">File system access in Emscripten</h2>
<p>The reason for the exception turned out to be simple - it couldn&rsquo;t find the ROM I specified to load. The reason for this is that WebAssembly is designed to be secure and <strong>to run in a sandboxed execution environment</strong> - the file that I was trying to load not in the Wasm sandbox.</p>
<p>To use files within Emscripten, a <a href="https://emscripten.org/docs/api_reference/Filesystem-API.html">File System API is provided</a> as well as a way to <a href="https://emscripten.org/docs/porting/files/packaging_files.html#packaging-files">package files</a>. Since I already had the C++ code for reading files, I went down the packaging files route. There are two <a href="https://emscripten.org/docs/tools_reference/emcc.html#emcc-preload-file">compiler options</a> that can do this job:</p>
<ul>
<li>
<p><code>--preload-file &lt;name&gt;</code>: allows you to pre-load a file or directory before running the compiled code asynchronously. The result is a <code>.data</code> file alongside your generated <code>.html</code> and <code>.js</code> which contains the preloaded files. This is the option I went with.</p>
</li>
<li>
<p><code>--embed-file &lt;file&gt;</code>: allows you to embed a file or path into the generated script. The result is that the files will be embedded inside your generated <code>.js</code> file. This is less efficient than pre-loading and should only be used when there are few files to load.</p>
</li>
</ul>
<p>After packaging the files, they can be accessed with file API calls from your C/C++ code as if the files existed locally.</p>
<p>Once I packaged the files properly, everything compiled again. I checked the website and there weren&rsquo;t any exceptions there, but the output was blank and the page was frozen:</p>

    <img src="img/blank-emscripten.png"  alt="Blank Emscripten"  class="center"  style="border-radius: 0.5em;"  />


<p>I also got the following warning:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">The AudioContext was not allowed to start. It must be resumed (or created) after a user gesture on the page. https://goo.gl/7K7WLu
</code></pre></div><p>For the time being, I decided to get rid of the audio handling code and sort this out later.</p>
<h2 id="emscripten-loops">Emscripten loops</h2>
<p>To get the screen buffer to update and not freeze the tab, I had to change the current loop that my current emulator runs on into an <a href="https://emscripten.org/docs/porting/emscripten-runtime-environment.html#browser-main-loop">Emscripten loop</a>. This is because the web browser event model uses co-operative multitasking, so each event gets a turn to run and has to return control to the browser. My code was blocking and never gave control back to the browser, so the tab froze and the display didn&rsquo;t update.</p>
<p>After a quick Google looking for some real-world examples on how to write an Emscripten loop, I found <a href="https://www.jamesfmackenzie.com/2019/12/03/webassembly-emscripten-loops/">James MacKenzie&rsquo;s blog</a> which has been a huge help on getting this to work.</p>
<p>A traditional loop in a C++ program using SDL looks like the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">while</span>(running) {
    renderFrame();
    SDL_Delay(timeToNextFrame());
}
</code></pre></div><p>And once rewritten to use Emscripten loops look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">emscripten_set_main_loop(renderFrame, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>);
</code></pre></div><p>Where the full signature of <code>emscripten_set_main_loop</code> is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">emscripten_set_main_loop(em_callback_func func, <span style="color:#66d9ef">int</span> fps, <span style="color:#66d9ef">int</span> simulate_infinite_loop)
</code></pre></div><p><code>emscripten_set_main_loop()</code> simulates an infinite loop, but in reality just calls the loop function a specified number of times a second. The amount of times that this loop gets called a second is specified by the second argument, however the <a href="https://emscripten.org/docs/api_reference/emscripten.h.html#c.emscripten_set_main_loop">Emscripten docs</a> mention that it&rsquo;s &ldquo;<strong>HIGHLY</strong> recommended&rdquo; to set this to 0 or a negative value when doing any rendering. The site will then use the browser’s <code>requestAnimationFrame</code> method to call the main loop function which we will revisit later.</p>
<h3 id="rewriting-for-a-global-function-in-the-main-loop">Rewriting for a global function in the main loop</h3>
<p>There is a major side effect of having to call a global function in my main loop - every object called within that global function also has to be accessible globally, or be local to that function.</p>
<p>My code wasn&rsquo;t designed with this in mind and would have been structured differently if I was writing it for Emscripten from the start. Anyway, I had to make a couple of objects global in my small <code>Main.cpp</code> file to make it accessible from the main loop. It&rsquo;s not a particularly elegant solution, but for this relatively simple project it sufficed.</p>
<p>As an effect of writing code this way your IDE may also complain about not being able to catch exceptions from variables with static storage duration - this is not a problem, and Emscripten will still be able to catch them for us if we add the exception handling in Javasript code that was described in the <a href="#debugging-emscripten">debugging section</a>.</p>
<p>My code went from looking something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// -- Headers --
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#66d9ef">try</span>
    {
        Config config{};

        Chip8 chip8{config.mode_};
        chip8.loadRom(config.romPath_);

        KeyboardHandler keyboardHandler(chip8.keys());
        Renderer renderer{<span style="color:#e6db74">&#34;CHIP-8 Emulator&#34;</span>, VIDEO_WIDTH, VIDEO_HEIGHT, config.videoScale_};

        <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">double</span> cycleDelay <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1.0</span> <span style="color:#f92672">/</span> config.cpuFrequency_) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000000000</span>;
        Timer cycleTimer(cycleDelay);

        <span style="color:#66d9ef">bool</span> quit <span style="color:#f92672">=</span> false;

        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>quit)
        {
            quit <span style="color:#f92672">=</span> keyboardHandler.handle();

            <span style="color:#66d9ef">if</span> (cycleTimer.intervalElapsed())
            {
                chip8.cycle();

                <span style="color:#66d9ef">if</span> (chip8.drawFlag())
                {
                    <span style="color:#75715e">// -- Graphics rendering code --
</span><span style="color:#75715e"></span>                }
            }
        }
    }
    <span style="color:#66d9ef">catch</span> (<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>exception <span style="color:#f92672">&amp;</span>e)
    {
        std<span style="color:#f92672">::</span>cerr <span style="color:#f92672">&lt;&lt;</span> e.what();
        std<span style="color:#f92672">::</span>exit(EXIT_FAILURE);
    }

    <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
}
</code></pre></div><p>To this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// -- Headers --
</span><span style="color:#75715e"></span>
Config config{};
Chip8 chip8{config.mode_};
KeyboardHandler <span style="color:#a6e22e">keyboardHandler</span>(chip8.keys());
Renderer renderer{<span style="color:#e6db74">&#34;WASM CHIP-8 Emulator&#34;</span>, VIDEO_WIDTH, VIDEO_HEIGHT, <span style="color:#ae81ff">13</span>};
<span style="color:#66d9ef">int</span> cyclesPerFrame <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">mainLoop</span>() {
    keyboardHandler.handle();

    chip8.cycle();

    <span style="color:#66d9ef">if</span> (chip8.drawFlag())
    {
        <span style="color:#75715e">// -- Graphics rendering code --
</span><span style="color:#75715e"></span>    }
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
    emscripten_set_main_loop(mainLoop, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);

    <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
}
</code></pre></div><p>At this point I&rsquo;ve also added a separate <code>Main.cpp</code> file just for Emscripten and added rules to pick up the right one in <code>CMakeLists.txt</code> depending on the compiler. The code has diverged a lot from my original <code>Main.cpp</code>, and adding preprocessor made the code difficult to trace through.</p>
<h3 id="emterpreter">Emterpreter</h3>
<p>Due to the amount of effort that may be required to rewrite traditional loops into Emscripten loops, depending on your project, Emscripten also provides <a href="https://github.com/emscripten-core/emscripten/wiki/Emterpreter">Emterpreter</a>. This allow you to keep traditional loops by adding <code>emscripten_sleep()</code> calls to your code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">while</span>(running) {
    renderFrame();
    emscripten_sleep(timeToNextFrame());
}
</code></pre></div><p>I gave this a go myself before rewriting my code for <code>emscripten_set_main_loop()</code> as I thought this could be a nice way to get things working quickly, but I found it to be a cumbersome process for a couple of reasons:</p>
<ul>
<li>
<p>Emterpreter is not available on the default LLVM backend that Emscripten uses. It&rsquo;s necessary to switch to the <code>fastcomp</code> backend, which is considered a legacy backend by Emscripten.</p>
</li>
<li>
<p>When compiling the code, you get various messages mentioning that code compiled using Emterpreter may run slowly.</p>
</li>
<li>
<p>Emterpreter seems to only be recommended to be used when absolutely necessary by the <a href="https://github.com/emscripten-core/emscripten/issues/8561">Emscripten devs</a>, and even then only by certain parts of your program.</p>
</li>
<li>
<p>It simply didn&rsquo;t work for my project. I got various errors and decided to switch back and to it the &ldquo;proper&rdquo; way, as also more support would be available for doing things that way.</p>
</li>
</ul>
<h3 id="frame-rate-issues">Frame rate issues</h3>
<p>I compiled the code after rewriting using an Emscripten loop and I got the emulator working!</p>

    <img src="img/working-emulator.png"  alt="Working Emulator"  class="center"  style="border-radius: 0.5em;"  />


<p>The emulator was very slow, however. I found that this is to do with the <code>requestAnimationFrame</code> method which I mentioned previously that is used to call the Emscripten main loop function.</p>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame">Mozilla docs</a> state that <code>requestAnimationFrame</code> gets called &ldquo;usually 60 times per second, but will generally match the display refresh rate in most web browsers&rdquo;. This was a problem, as my main loop simulated <strong>one</strong> CHIP-8 cycle every time it was called. Effectively this meant that my the emulator ran at a frequency of 60Hz when compiled with Emscripten, where most CHIP-8 ROMs run well at 1000-1500Hz depending on the game (this isn&rsquo;t something that can be determined on the fly, as in ordinary game loops).</p>
<p>To fix this issue, I added a constant which determines how many cycles to emulate every time the main Emscripten loop is given control. Calculating this constant wasn&rsquo;t very straightforward, as the frame rate which ran natively didn&rsquo;t directly translate to what ran in Emscripten. For example, if I ran a game at 1000Hz natively, I should be able to divide that by 60 to get the amount of cycles to emulate between every frame in an Emscripten loop - around 17 in this case. This wasn&rsquo;t the case however, as the Emscripten loop ran much faster than anticipated: to get an Emscripten loop running at a similar speed to one running natively at 1000Hz, I set the amount of loops to emulate per frame to 10. I found this through a process of trial-and-error as there didn&rsquo;t seem to be a good way to calculate this difference upfront.</p>
<p>Also it&rsquo;s worth nothing that not every screen will refresh at 60 frames a second, which is something to consider if you want the program to run at the same speed for everyone.</p>
<p>The logic for emulating a set amount of cycles per frame looked as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">int</span> cyclesPerFrame <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">mainLoop</span>() {
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> cyclesPerFrame; i<span style="color:#f92672">++</span>)
    {
        chip8.cycle();
    }
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
    emscripten_set_main_loop(mainLoop, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
}
</code></pre></div><p>After compiling the emulator again with this change, everything worked as expected. Surprisingly, the keyboard also worked perfectly and didn&rsquo;t require any intervention.</p>
<h2 id="exporting-c-functions-to-call-from-javascript">Exporting C++ functions to call from JavaScript</h2>
<p>To finish this off, I wanted to add a dropdown so it&rsquo;s possible to select a game to load (turns out Pong gets a bit boring after a while). First, I added a function to my C++ code which will get exported so it can be called from JavaScript. There is a page in <a href="https://emscripten.org/docs/porting/connecting_cpp_and_javascript/Interacting-with-code.html">the Emscripted docs</a> which explains this in good detail. The function looked as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">extern</span> <span style="color:#e6db74">&#34;C&#34;</span> {
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loadRom</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>path, <span style="color:#66d9ef">int</span> cyclesPerFrame_) {
    cyclesPerFrame <span style="color:#f92672">=</span> cyclesPerFrame_;

    chip8.reset();
    chip8.loadRom(path);
}
}
</code></pre></div><p>The function is wrapped in <code>extern &quot;C&quot;</code> to prevent C++ name mangling. I also added a <code>cyclesPerFrame_</code> parameter as many CHIP-8 ROMs need to have their frame rate adjusted to run at an appropriate speed.</p>
<p>Next, I exported the function to enable it to be called from JavaScript. In order to call a C++ function from JavaScript, I also need to export the runtime <code>ccall</code> and/or <code>cwrap</code> methods which are called on the <code>Module</code> JavaScript object which <a href="https://emscripten.org/docs/api_reference/module.html">the Emscripten-generated code calls at various points in its execution</a>. To do this, I added the following to my compiler flags:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmake" data-lang="cmake"><span style="color:#960050;background-color:#1e0010">-s</span> <span style="color:#960050;background-color:#1e0010">EXPORTED_FUNCTIONS=\&#34;[&#39;_main&#39;,</span> <span style="color:#960050;background-color:#1e0010">&#39;_loadRom&#39;]\&#34;</span> <span style="color:#960050;background-color:#1e0010">\
</span><span style="color:#960050;background-color:#1e0010">-s</span> <span style="color:#960050;background-color:#1e0010">EXPORTED_RUNTIME_METHODS=\&#34;[&#39;ccall&#39;,</span> <span style="color:#960050;background-color:#1e0010">&#39;cwrap&#39;]\&#34;</span> <span style="color:#960050;background-color:#1e0010">\
</span><span style="color:#960050;background-color:#1e0010">-s</span> <span style="color:#960050;background-color:#1e0010">ALLOW_MEMORY_GROWTH=1</span> <span style="color:#960050;background-color:#1e0010">\
</span><span style="color:#960050;background-color:#1e0010">--no-heap-copy</span> <span style="color:#960050;background-color:#1e0010">\
</span></code></pre></div><p>Note that I also exported <code>main</code> as I want to be able to call the main function myself and not start it automatically when the page is loaded. The <code>-s ALLOW_MEMORY_GROWTH=1</code> and <code>--no-heap-copy</code> flags are necessary as the memory used by the WASM code will increase when we load a game. This shouldn&rsquo;t <a href="https://emscripten.org/docs/optimizing/Optimizing-Code.html#memory-growth">have any overhead</a> when compiling to WebAssembly.</p>
<p>Next, I made some changes to the <code>shell.html</code> file:</p>
<ul>
<li>
<p>I set <code>noInitialRun</code> to <code>true</code> in the JavaScript <code>Module</code> object so it doesn&rsquo;t automatically run the emulator when the page loads.</p>
</li>
<li>
<p>Added a dropdown for selecting which ROM to load. Each option includes a path to a ROM to load and specifies the amount of cycles to emulate per frame, which differs per game.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;emscripten&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;menu&#34;</span>&gt;
  &lt;<span style="color:#f92672">select</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rom-dropdown&#34;</span>&gt;
    &lt;<span style="color:#f92672">option</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{&#34;name&#34;: &#34;games/Pong (1 player).ch8&#34;,&#34;cyclesPerFrame&#34;:10}&#39;</span>&gt;
      PONG
    &lt;/<span style="color:#f92672">option</span>&gt;
    <span style="color:#75715e">&lt;!-- More ROMs --&gt;</span>
  &lt;/<span style="color:#f92672">select</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;
</code></pre></div></li>
<li>
<p>Added a JavaScript listener to check for changes in the dropdown when the WebAssembly code has loaded, and call the exported C++ function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getRomOptionsFromDropdown</span>(<span style="color:#a6e22e">optionText</span>) {
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">romOptions</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">optionText</span>);
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">romName</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">romOptions</span>[<span style="color:#e6db74">&#34;name&#34;</span>];
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">romPath</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bin/roms/revival/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">romName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\0&#34;</span>;

  <span style="color:#a6e22e">selectedRomUInt8Array</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TextEncoder</span>().<span style="color:#a6e22e">encode</span>(<span style="color:#a6e22e">romPath</span>);
  <span style="color:#a6e22e">cyclesPerFrame</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">romOptions</span>[<span style="color:#e6db74">&#34;cyclesPerFrame&#34;</span>];

  <span style="color:#a6e22e">Module</span>.<span style="color:#a6e22e">ccall</span>( <span style="color:#e6db74">&#34;loadRom&#34;</span>, <span style="color:#e6db74">&#34;null&#34;</span>, [<span style="color:#e6db74">&#34;array&#34;</span>, <span style="color:#e6db74">&#34;number&#34;</span>], [<span style="color:#a6e22e">selectedRomUInt8Array</span>, <span style="color:#a6e22e">cyclesPerFrame</span>] );
}

<span style="color:#a6e22e">Module</span>[<span style="color:#e6db74">&#34;onRuntimeInitialized&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
  <span style="color:#a6e22e">getRomOptionsFromDropdown</span>(document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#34;#rom-dropdown&#34;</span>).<span style="color:#a6e22e">value</span>);

  document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#34;#rom-dropdown&#34;</span>).<span style="color:#a6e22e">onchange</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">event</span>) {
    <span style="color:#a6e22e">getRomOptionsFromDropdown</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">value</span>);
  };
</code></pre></div><ul>
<li>Note that JavaScript strings are not null terminated. Since we&rsquo;re passing the string with the ROM path from JavaScript to C++ code, we have to append a null character manually as C and C++ strings must be null-terminated. If the string is not null-terminated, then certain C++ functions which rely on the string being null-terminated won&rsquo;t work as expected.</li>
</ul>
</li>
</ul>
<h2 id="audio">Audio</h2>
<p>I mentioned that I&rsquo;d come back to audio earlier in this post. The only audio in the emulator is a simple &ldquo;beep&rdquo;, implemented as a sine wave that which gets played on a separate thread. To compile the code I had to add some extra compiler flags as described in the <a href="https://emscripten.org/docs/porting/pthreads.html">Emscripten Pthreads support page</a> to allow for multithreading in Emscripten.</p>
<p>I compiled the code with the audio enabled and checked how Chrome treats it. The audio played when it should, however it ended up being a high pitched noise of varying frequencies which didn&rsquo;t stop - not exactly what I wanted. Changing various settings didn&rsquo;t seem to have an effect on the noise produced. I also gave it a go in Firefox, which required me to enable a flag as the support in Firefox for Webassembly <code>pthread</code>s is currently experimental. Once the flag was enabled, Firefox had various issues with the audio device and I didn&rsquo;t see pursuing this any further worthwhile.</p>
<p>In order to make this work, I a good way would be to handle the audio entirely in JavaScript and query the emulator for when a sound should play. Since I didn&rsquo;t see much value in adding sound to the emulator, I left it out.</p>
<h2 id="finishing-touches">Finishing touches</h2>
<p>That&rsquo;s pretty much it - I managed to compile the emulator into WebAssembly, I added the ability to play different games and to host the emulator online. To finish the emulator off, I added some CSS styling, a start/stop button and instructions on how to play which was easy to do by editing the default Emscripten shell file.</p>
<p>An extra thing which was worth doing is checking how the site behaved in different web browsers. For example I made the assumption in my JavaScript code that the game picker dropdown will always not have a game selected when the page is loaded. This held for Chrome, but not for Firefox which remembers what the last option that the user picked in a dropdown was, so I had to handle that case accordingly.</p>
<h2 id="the-end">The end!</h2>
<p>I hope this post was somewhat insightful for anyone looking at compiling their own C or C++ code into WebAssembly. I think there&rsquo;s huge potential in the technology, and can be very useful for computationally expensive tasks which aren&rsquo;t viable to be ran using JavaScript. For examples of more sophisticated projects using WebAssembly and some inspiration, I recommend having a look <a href="https://madewithwebassembly.com/">Made with WebAssembly</a>.</p>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://dominikrys.com/tags/software-engineering/">software engineering</a></span>
        <span class="tag"><a href="https://dominikrys.com/tags/webassembly/">webassembly</a></span>
        <span class="tag"><a href="https://dominikrys.com/tags/c&#43;&#43;/">c&#43;&#43;</a></span>
        <span class="tag"><a href="https://dominikrys.com/tags/emscripten/">emscripten</a></span>
        <span class="tag"><a href="https://dominikrys.com/tags/sdl/">sdl</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        3380 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2020-08-15 16:55 &#43;0100
        

         
          
        
      </p>
    </div>

    
    <div class="pagination">
        <div class="pagination__title">
            <span class="pagination__title-h"></span>
            <hr />
        </div>

        <div class="pagination__buttons">
            
            <span class="button previous">
                <a href="https://dominikrys.com/posts/2020/09/monitoring-corda-nodes-using-grafana-influxdb-and-telegraf/">
                    <span class="button__icon">←</span>
                    <span class="button__text">Monitoring Corda Nodes Using Grafana, InfluxDB, and Telegraf</span>
                </a>
            </span>
            

            
            <span class="button next">
                <a href="https://dominikrys.com/posts/2020/08/first-blog-post/">
                    <span class="button__text">First Blog Post</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            
        </div>
    </div>


    
      
        <div id="comments">
          <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "dominikrys" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
      
    

    

  </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2021</span>
            <span><a href="https://dominikrys.com">Dominik Rys</a></span>
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="https://dominikrys.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="https://dominikrys.com/bundle.min.599099f1f14b78b657d524b28e10e0c5098e7cd46e9c7aed73d577068a276c3ff1bb234cbf29cb313333e83cf411727b43157c91ce5b809e2ffc81664614608e.js" integrity="sha512-WZCZ8fFLeLZX1SSyjhDgxQmOfNRunHrtc9V3BoonbD/xuyNMvynLMTMz6Dz0EXJ7QxV8kc5bgJ4v/IFmRhRgjg=="></script>



    </body>
</html>
